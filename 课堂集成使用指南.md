# ğŸ“ Guardian è¯¾å ‚é›†æˆä½¿ç”¨æŒ‡å—

**åŠŸèƒ½**: å­¦ç”Ÿä¸Šè¯¾åˆ‡æ¢åˆ°å…¶ä»–ç½‘ç«™æ—¶ï¼Œè‡ªåŠ¨å‘é€ä¿¡æ¯ç»™è¯¾å ‚ç³»ç»Ÿ

---

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. å®æ—¶ä¸ŠæŠ¥å­¦ç”Ÿè®¿é—®è¡Œä¸º
- âœ… è®¿é—®çš„URL
- âœ… è®¿é—®æ—¶é—´
- âœ… å­¦ç”Ÿå§“å
- âœ… æ˜¯å¦è¢«æ‹¦æˆª

### 2. å®æ—¶è­¦æŠ¥
- âœ… å­¦ç”Ÿè®¿é—®è¿è§„ç½‘ç«™ â†’ ç«‹å³é€šçŸ¥æ•™å¸ˆ
- âœ… å­¦ç”Ÿå…³é—­ä¿æŠ¤ â†’ ç«‹å³è­¦æŠ¥
- âœ… å­¦ç”Ÿç¦ç”¨æ’ä»¶ â†’ ç«‹å³è­¦æŠ¥

### 3. æ•°æ®ç»Ÿè®¡
- âœ… è¯¾å ‚æœŸé—´è®¿é—®ç»Ÿè®¡
- âœ… æ¯ä¸ªå­¦ç”Ÿçš„è¿è§„æ¬¡æ•°
- âœ… æœ€å¸¸è®¿é—®çš„è¿è§„ç½‘ç«™

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨ï¼ˆ3æ­¥éª¤ï¼‰

### æ­¥éª¤1ï¼šå¯ç”¨è¯¾å ‚æ¨¡å¼

**åœ¨å­¦ç”ŸåŠ å…¥è¯¾å ‚æ—¶ï¼Œè¿è¡Œè¿™ä¸ªä»£ç ï¼ˆæµè§ˆå™¨æ§åˆ¶å°ï¼‰ï¼š**

```javascript
chrome.runtime.sendMessage('pdpjidcjmkolcdaiolapcomjnbhgjekf', {
  action: 'enableClassroomMode',
  data: {
    sessionId: 123,                    // è¯¾å ‚ID
    serverUrl: 'http://localhost:8086', // MetaSeekOJæœåŠ¡å™¨
    allowedDomains: [
      'metaseekoj.com',
      'localhost',
      'baidu.com'
    ]
  }
}, (response) => {
  console.log(response.message); // "è¯¾å ‚æ¨¡å¼å·²å¯ç”¨"
});
```

### æ­¥éª¤2ï¼šç»‘å®šå­¦ç”Ÿä¿¡æ¯

```javascript
chrome.runtime.sendMessage('pdpjidcjmkolcdaiolapcomjnbhgjekf', {
  action: 'bindUser',
  data: {
    userId: 'S001',
    username: 'å¼ ä¸‰'
  }
});
```

### æ­¥éª¤3ï¼šæµ‹è¯•

- å­¦ç”Ÿè®¿é—® www.bilibili.com
- Guardian æ‹¦æˆªå¹¶å‘é€æ•°æ®åˆ°ï¼š
  ```
  POST http://localhost:8086/api/classroom/guardian-alert/
  ```

---

## ğŸ“¡ ä¸ŠæŠ¥çš„æ•°æ®æ ¼å¼

### å®æ—¶è­¦æŠ¥ï¼ˆå­¦ç”Ÿè®¿é—®è¿è§„ç½‘ç«™ï¼‰

```json
{
  "type": "blocked_access",
  "session_id": 123,
  "student_id": "S001",
  "student_name": "å¼ ä¸‰",
  "domain": "bilibili.com",
  "url": "https://www.bilibili.com",
  "timestamp": 1698739200000,
  "message": "å­¦ç”Ÿ å¼ ä¸‰ å°è¯•è®¿é—®è¢«æ‹¦æˆªçš„ç½‘ç«™: bilibili.com"
}
```

**å‘é€åˆ°**: `POST /api/classroom/guardian-alert/`

### æ‰¹é‡è®¿é—®è®°å½•ï¼ˆæ¯5ç§’ä¸ŠæŠ¥ï¼‰

```json
{
  "reports": [
    {
      "session_id": 123,
      "student_id": "S001",
      "student_name": "å¼ ä¸‰",
      "url": "https://www.baidu.com",
      "domain": "baidu.com",
      "allowed": true,
      "timestamp": 1698739200000,
      "timestamp_str": "2025-10-31 16:30:00"
    }
  ]
}
```

**å‘é€åˆ°**: `POST /api/classroom/guardian-reports/`

---

## ğŸ–¥ï¸ MetaSeekOJ åç«¯é›†æˆ

### 1. åˆ›å»ºæ•°æ®åº“è¡¨

**æ–‡ä»¶**: `OnlineJudge/classroom/guardian_integration.py` ï¼ˆå·²åˆ›å»ºï¼‰

**æ•°æ®è¡¨**ï¼š
- `classroom_guardian_reports` - è®¿é—®è®°å½•
- `classroom_guardian_alerts` - å®æ—¶è­¦æŠ¥

### 2. åˆ›å»ºAPIè§†å›¾

**æ–‡ä»¶**: `OnlineJudge/classroom/guardian_views.py` ï¼ˆå·²åˆ›å»ºï¼‰

**APIç«¯ç‚¹**ï¼š
- `POST /api/classroom/guardian-reports/` - æ¥æ”¶è®¿é—®è®°å½•
- `POST /api/classroom/guardian-alert/` - æ¥æ”¶å®æ—¶è­¦æŠ¥
- `GET /api/classroom/sessions/{id}/guardian-report/` - æŸ¥çœ‹æŠ¥å‘Š
- `GET /api/classroom/sessions/{id}/guardian-alerts/` - æŸ¥çœ‹è­¦æŠ¥

### 3. é…ç½®è·¯ç”±

åœ¨ `OnlineJudge/classroom/urls.py` æ·»åŠ ï¼š

```python
from django.urls import path, include

urlpatterns = [
    # ç°æœ‰è·¯ç”±
    path('courses/', ...),
    path('sessions/', ...),
    
    # Guardiané›†æˆ
    path('', include('classroom.guardian_urls')),
]
```

### 4. æ³¨å†Œæ¨¡å‹åˆ°admin

åœ¨ `OnlineJudge/classroom/admin.py` æ·»åŠ ï¼š

```python
from .guardian_integration import GuardianAccessReport, GuardianAlert

@admin.register(GuardianAccessReport)
class GuardianAccessReportAdmin(admin.ModelAdmin):
    list_display = ['student', 'domain', 'allowed', 'timestamp']
    list_filter = ['allowed', 'timestamp']
    search_fields = ['domain', 'student__real_name']

@admin.register(GuardianAlert)
class GuardianAlertAdmin(admin.ModelAdmin):
    list_display = ['student', 'alert_type', 'domain', 'is_read', 'timestamp']
    list_filter = ['alert_type', 'is_read', 'timestamp']
    search_fields = ['domain', 'student__real_name']
```

---

## ğŸ¯ å®Œæ•´æµ‹è¯•æµç¨‹

### 1. åç«¯éƒ¨ç½²

```bash
cd /home/sharelgx/MetaSeekOJdev/OnlineJudge
source django_env/bin/activate

# è¿ç§»æ•°æ®åº“
python manage.py makemigrations classroom
python manage.py migrate

# é‡å¯æœåŠ¡
supervisorctl restart metaseekoj
```

### 2. å‰ç«¯é›†æˆ

åœ¨ `OnlineJudgeFE/src/pages/classroom/student/views/Learning.vue` çš„ `mounted()` ä¸­æ·»åŠ ï¼š

```javascript
mounted() {
  this.enableGuardian();
},

methods: {
  async enableGuardian() {
    const extensionId = 'pdpjidcjmkolcdaiolapcomjnbhgjekf';
    
    try {
      // ç»‘å®šå­¦ç”Ÿ
      await chrome.runtime.sendMessage(extensionId, {
        action: 'bindUser',
        data: {
          userId: this.$store.getters.user.id,
          username: this.$store.getters.user.real_name
        }
      });
      
      // å¯ç”¨è¯¾å ‚æ¨¡å¼
      await chrome.runtime.sendMessage(extensionId, {
        action: 'enableClassroomMode',
        data: {
          sessionId: this.$route.params.id,
          serverUrl: window.location.origin,
          allowedDomains: ['metaseekoj.com', 'localhost', 'baidu.com']
        }
      });
      
      this.$message.success('è¯¾å ‚ä¿æŠ¤å·²å¯ç”¨');
    } catch (error) {
      console.error('Guardianå¯ç”¨å¤±è´¥:', error);
    }
  }
}
```

### 3. æµ‹è¯•

```bash
1. å­¦ç”Ÿç™»å½• MetaSeekOJ
2. åŠ å…¥è¯¾å ‚ â†’ Guardianè‡ªåŠ¨å¯ç”¨
3. å­¦ç”Ÿè®¿é—® bilibili.com â†’ è¢«æ‹¦æˆª
4. åç«¯æ¥æ”¶åˆ°è­¦æŠ¥
5. æ•™å¸ˆç«¯æ˜¾ç¤ºé€šçŸ¥
```

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

### å­¦ç”Ÿç«¯ï¼ˆè‡ªåŠ¨ï¼‰

åŠ å…¥è¯¾å ‚æ—¶è‡ªåŠ¨ï¼š
1. ç»‘å®šå­¦ç”Ÿä¿¡æ¯
2. å¯ç”¨Guardianä¿æŠ¤
3. å¼€å§‹ä¸ŠæŠ¥è®¿é—®è®°å½•

### æ•™å¸ˆç«¯ï¼ˆæŸ¥çœ‹æ•°æ®ï¼‰

**æ–¹å¼1ï¼šæŸ¥çœ‹å®æ—¶è­¦æŠ¥**
```javascript
// æ¯5ç§’è½®è¯¢
setInterval(async () => {
  const { data } = await axios.get(
    `/api/classroom/sessions/${sessionId}/guardian-alerts/`,
    { params: { unread_only: true } }
  );
  
  if (data.unread > 0) {
    // æ˜¾ç¤ºé€šçŸ¥
    showNotification(`æœ‰ ${data.unread} æ¡æ–°è­¦æŠ¥`);
  }
}, 5000);
```

**æ–¹å¼2ï¼šæŸ¥çœ‹å®Œæ•´æŠ¥å‘Š**
```javascript
const { data } = await axios.get(
  `/api/classroom/sessions/${sessionId}/guardian-report/`
);

// data.students - æ¯ä¸ªå­¦ç”Ÿçš„ç»Ÿè®¡
// data.top_blocked_domains - æœ€å¸¸è¿è§„çš„ç½‘ç«™
```

---

## ğŸ‰ å®Œæˆï¼

Guardian è¯¾å ‚é›†æˆå·²å…¨éƒ¨å®Œæˆï¼

**åŠŸèƒ½**ï¼š
- âœ… å­¦ç”Ÿåˆ‡æ¢ç½‘ç«™ â†’ å®æ—¶ä¸ŠæŠ¥
- âœ… åŒ…å«æ—¶é—´ã€ç½‘å€ã€å­¦ç”Ÿå§“å
- âœ… è¿è§„ç«‹å³è­¦æŠ¥
- âœ… è¯¾åæŸ¥çœ‹æŠ¥å‘Š

**æµ‹è¯•**ï¼šåˆ·æ–°Guardianæ’ä»¶åï¼Œè¿è¡Œå¯ç”¨è¯¾å ‚æ¨¡å¼çš„ä»£ç å³å¯ï¼

---

**éœ€è¦åç«¯éƒ¨ç½²å¸®åŠ©éšæ—¶å‘Šè¯‰æˆ‘ï¼** ğŸ˜Š


# ğŸ“ Guardian è¯¾å ‚æ¥å£ - å®Œæˆæ€»ç»“

**å®Œæˆæ—¶é—´**: 2025-10-31  
**çŠ¶æ€**: âœ… æ¥å£å·²å®ç°

---

## âœ… æ‚¨è¦æ±‚çš„åŠŸèƒ½å·²å…¨éƒ¨å®ç°

### éœ€æ±‚ï¼šå­¦ç”Ÿä¸Šè¯¾åˆ‡æ¢åˆ°å…¶ä»–ç½‘ç«™å°±å‘é€ä¿¡æ¯

**å·²å®ç°**ï¼š
- âœ… æ£€æµ‹å­¦ç”Ÿè®¿é—®ä»»ä½•ç½‘ç«™
- âœ… å®æ—¶å‘é€åˆ°MetaSeekOJåç«¯
- âœ… åŒ…å«ï¼šæ—¶é—´ã€ç½‘å€ã€å­¦ç”Ÿå§“åã€æ˜¯å¦è¢«æ‹¦æˆª

---

## ğŸ“¡ å·¥ä½œæµç¨‹

```
å­¦ç”Ÿä¸Šè¯¾ â†’ è®¿é—®ç½‘ç«™
    â†“
Guardianæ£€æµ‹ï¼ˆæ’ä»¶ï¼‰
    â†“
â‘  å…è®¸è®¿é—® â†’ è®°å½• â†’ 5ç§’åæ‰¹é‡ä¸ŠæŠ¥
â‘¡ æ‹¦æˆªè®¿é—® â†’ è®°å½• â†’ ç«‹å³è­¦æŠ¥
    â†“
å‘é€åˆ°MetaSeekOJ
    â†“
POST /api/classroom/guardian-alert/     (ç«‹å³)
POST /api/classroom/guardian-reports/   (æ‰¹é‡)
    â†“
Djangoåç«¯ä¿å­˜
    â†“
æ•™å¸ˆç«¯æŸ¥çœ‹
    â†“
å®æ—¶é€šçŸ¥ + è¯¾åæŠ¥å‘Š
```

---

## ğŸ“Š ä¸ŠæŠ¥æ•°æ®ç¤ºä¾‹

### æ•°æ®1ï¼šå­¦ç”Ÿè®¿é—®è¿è§„ç½‘ç«™ï¼ˆç«‹å³å‘é€ï¼‰

```json
{
  "type": "blocked_access",
  "session_id": 123,
  "student_id": "S001",
  "student_name": "å¼ ä¸‰",
  "domain": "bilibili.com",
  "url": "https://www.bilibili.com/video/xxx",
  "timestamp": 1698739200000,
  "message": "å­¦ç”Ÿ å¼ ä¸‰ å°è¯•è®¿é—®è¢«æ‹¦æˆªçš„ç½‘ç«™: bilibili.com"
}
```

**åŒ…å«ä¿¡æ¯**ï¼š
- âœ… å­¦ç”Ÿå§“åï¼šå¼ ä¸‰
- âœ… ç½‘å€ï¼šbilibili.com
- âœ… æ—¶é—´ï¼š2025-10-31 16:30:00
- âœ… æ˜¯å¦æ‹¦æˆªï¼šæ˜¯

### æ•°æ®2ï¼šå­¦ç”Ÿæ­£å¸¸è®¿é—®ï¼ˆæ‰¹é‡å‘é€ï¼‰

```json
{
  "reports": [
    {
      "session_id": 123,
      "student_id": "S001",
      "student_name": "å¼ ä¸‰",
      "url": "https://www.baidu.com/s?wd=python",
      "domain": "baidu.com",
      "allowed": true,
      "reason": "",
      "timestamp": 1698739200000,
      "timestamp_str": "2025-10-31 16:30:00"
    }
  ]
}
```

---

## ğŸ”§ é›†æˆæ­¥éª¤

### æ­¥éª¤1ï¼šåˆ·æ–°Guardianæ’ä»¶

```bash
# æ’ä»¶å·²æ›´æ–°ä»£ç ï¼Œéœ€è¦åˆ·æ–°
chrome://extensions/ â†’ Guardian â†’ ç‚¹åˆ·æ–° ğŸ”„
```

### æ­¥éª¤2ï¼šéƒ¨ç½²åç«¯API

```bash
cd /home/sharelgx/MetaSeekOJdev/OnlineJudge
source django_env/bin/activate

# æ•°æ®åº“è¿ç§»
python manage.py makemigrations classroom
python manage.py migrate

# é…ç½®è·¯ç”±ï¼ˆåœ¨ classroom/urls.pyï¼‰
# æ·»åŠ ï¼špath('', include('classroom.guardian_urls')),

# é‡å¯æœåŠ¡
supervisorctl restart metaseekoj
```

### æ­¥éª¤3ï¼šå‰ç«¯å¯ç”¨è¯¾å ‚æ¨¡å¼

åœ¨å­¦ç”ŸåŠ å…¥è¯¾å ‚é¡µé¢æ·»åŠ ä»£ç ï¼ˆè‡ªåŠ¨æ‰§è¡Œï¼‰ï¼š

```javascript
// Learning.vue
mounted() {
  this.enableGuardianClassroomMode();
},

methods: {
  async enableGuardianClassroomMode() {
    const extensionId = 'pdpjidcjmkolcdaiolapcomjnbhgjekf';
    
    try {
      // 1. ç»‘å®šå­¦ç”Ÿ
      await chrome.runtime.sendMessage(extensionId, {
        action: 'bindUser',
        data: {
          userId: this.$store.getters.user.id,
          username: this.$store.getters.user.real_name
        }
      });
      
      // 2. å¯ç”¨è¯¾å ‚æ¨¡å¼
      await chrome.runtime.sendMessage(extensionId, {
        action: 'enableClassroomMode',
        data: {
          sessionId: this.$route.params.id,
          serverUrl: window.location.origin,
          allowedDomains: [
            'metaseekoj.com',
            'localhost',
            'baidu.com',
            'python.org'
          ]
        }
      });
      
      this.$message.success('è¯¾å ‚ä¿æŠ¤å·²å¯ç”¨');
    } catch (error) {
      console.error('å¯ç”¨å¤±è´¥:', error);
    }
  }
}
```

### æ­¥éª¤4ï¼šæ•™å¸ˆç«¯æŸ¥çœ‹è­¦æŠ¥

```javascript
// Teaching.vue
data() {
  return {
    guardianAlerts: []
  }
},

mounted() {
  this.startMonitoring();
},

methods: {
  startMonitoring() {
    setInterval(async () => {
      const { data } = await this.$http.get(
        `/api/classroom/sessions/${this.sessionId}/guardian-alerts/`,
        { params: { unread_only: true } }
      );
      
      if (data.unread > 0) {
        this.$notify({
          title: 'âš ï¸ å­¦ç”Ÿè®¿é—®è¿è§„ç½‘ç«™',
          message: `${data.alerts[0].student_name} è®¿é—®äº† ${data.alerts[0].domain}`,
          type: 'warning'
        });
      }
    }, 5000);
  }
}
```

---

## ğŸ¯ æµ‹è¯•ç¤ºä¾‹

### æ‰‹åŠ¨æµ‹è¯•ï¼ˆå¼€å‘æ—¶ï¼‰

**åœ¨Guardiançš„Service Workeræ§åˆ¶å°è¿è¡Œï¼š**

```javascript
// 1. å¯ç”¨è¯¾å ‚æ¨¡å¼
chrome.runtime.sendMessage({
  action: 'enableClassroomMode',
  data: {
    sessionId: 1,
    serverUrl: 'http://localhost:8086',
    allowedDomains: ['localhost', 'baidu.com']
  }
}, (r) => console.log(r));

// 2. ç»‘å®šå­¦ç”Ÿ
chrome.runtime.sendMessage({
  action: 'bindUser',
  data: {
    userId: 'test001',
    username: 'æµ‹è¯•å­¦ç”Ÿ'
  }
}, (r) => console.log(r));

// 3. è®¿é—®Bç«™æµ‹è¯•
// æ‰“å¼€æ–°æ ‡ç­¾é¡µè®¿é—® www.bilibili.com
// æ§åˆ¶å°åº”è¯¥æ˜¾ç¤ºï¼š
// ğŸš¨ è¿è§„è­¦æŠ¥å·²å‘é€
```

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### Guardianæ’ä»¶ï¼ˆå·²æ›´æ–°ï¼‰
```
extension/background.js
- æ–°å¢ï¼šè¯¾å ‚æ¨¡å¼é…ç½®
- æ–°å¢ï¼šreportToClassroom() ä¸ŠæŠ¥å‡½æ•°
- æ–°å¢ï¼šsendClassroomReport() å‘é€æ•°æ®
- æ–°å¢ï¼šsendClassroomAlert() å‘é€è­¦æŠ¥
- æ–°å¢ï¼šenableClassroomMode æ¶ˆæ¯å¤„ç†
```

### MetaSeekOJåç«¯ï¼ˆæ–°å¢ï¼‰
```
OnlineJudge/classroom/
â”œâ”€â”€ guardian_integration.py  # æ•°æ®æ¨¡å‹
â”œâ”€â”€ guardian_views.py        # APIè§†å›¾
â””â”€â”€ guardian_urls.py         # URLé…ç½®
```

### æ–‡æ¡£
```
.trae/documents/
â””â”€â”€ Guardianè¯¾å ‚é›†æˆæ¥å£æ–‡æ¡£.md  # å®Œæ•´æ¥å£æ–‡æ¡£

guardian-browser-extension/
â””â”€â”€ è¯¾å ‚é›†æˆä½¿ç”¨æŒ‡å—.md          # ä½¿ç”¨æŒ‡å—
```

---

## ğŸ‰ æ€»ç»“

**Guardian è¯¾å ‚é›†æˆæ¥å£å·²å®Œæˆï¼**

âœ… **å®æ—¶ä¸ŠæŠ¥** - å­¦ç”Ÿè®¿é—®ä»»ä½•ç½‘ç«™éƒ½ä¼šä¸ŠæŠ¥  
âœ… **è¿è§„è­¦æŠ¥** - è®¿é—®è¿è§„ç½‘ç«™ç«‹å³é€šçŸ¥æ•™å¸ˆ  
âœ… **è¯¦ç»†ä¿¡æ¯** - æ—¶é—´ã€ç½‘å€ã€å­¦ç”Ÿå§“åå…¨éƒ¨åŒ…å«  
âœ… **æ•°æ®ç»Ÿè®¡** - è¯¾åç”Ÿæˆå®Œæ•´æŠ¥å‘Š  

**æ¥ä¸‹æ¥**ï¼š
1. åˆ·æ–°Guardianæ’ä»¶
2. éƒ¨ç½²MetaSeekOJåç«¯API
3. åœ¨è¯¾å ‚é¡µé¢é›†æˆä»£ç 
4. æµ‹è¯•å®Œæ•´æµç¨‹

**æœ‰ä»»ä½•é—®é¢˜éšæ—¶é—®æˆ‘ï¼** ğŸ˜Š


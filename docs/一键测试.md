# 🧪 Guardian 一键测试脚本

## ⚠️ 重要：先刷新插件

```
1. 打开 chrome://extensions/
2. 找到 Guardian
3. 点击 🔄 刷新按钮
```

---

## 🎯 方法1：控制台直接测试（100%有效）

### 步骤1：打开Service Worker控制台

```
1. chrome://extensions/
2. 找到 Guardian - 浏览器保护助手
3. 点击「Service Worker」（蓝色链接）
4. 会打开开发者工具
```

### 步骤2：复制粘贴这段代码

```javascript
// 一键配置：启用保护 + 添加B站到黑名单
chrome.storage.local.set({
  guardian_config: {
    enabled: true,
    mode: 'blacklist',
    blacklist: ['bilibili.com', 'www.bilibili.com'],
    whitelist: [],
    timeControl: { enabled: false, schedules: [] },
    dailyLimit: { 
      enabled: false, 
      maxMinutes: 120, 
      usedMinutes: 0,
      lastResetDate: new Date().toISOString().split('T')[0]
    },
    tempPass: { active: false, domain: null, expiresAt: null },
    stats: { 
      todayBlocked: 0, 
      totalBlocked: 0, 
      todayAllowed: 0,
      lastResetDate: new Date().toISOString().split('T')[0]
    },
    violationLogs: [],
    userInfo: { 
      userId: 'student001', 
      username: '测试学生',
      bindTime: Date.now()
    },
    password: '1234',
    firstInstall: false
  }
}, () => {
  console.log('✅ 配置已保存！');
  console.log('📋 配置详情:');
  console.log('- 保护状态: 已启用');
  console.log('- 黑名单: bilibili.com');
  console.log('- 用户: 测试学生');
  alert('✅ 配置成功！现在访问 www.bilibili.com 试试');
});
```

### 步骤3：按回车执行

看到弹窗提示：**✅ 配置成功！现在访问 www.bilibili.com 试试**

### 步骤4：测试拦截

```
1. 打开新标签页
2. 访问 www.bilibili.com
3. 应该看到紫色渐变拦截页面！
```

---

## 🎯 方法2：验证配置是否生效

### 检查配置

在Service Worker控制台运行：

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  console.log('当前配置:', data.guardian_config);
  
  if (data.guardian_config) {
    console.log('✅ 保护已启用:', data.guardian_config.enabled);
    console.log('📋 黑名单:', data.guardian_config.blacklist);
    console.log('👤 绑定用户:', data.guardian_config.userInfo?.username);
  } else {
    console.log('❌ 配置未初始化');
  }
});
```

---

## 🔍 调试：查看拦截日志

访问几个网站后，查看日志：

```javascript
chrome.storage.local.get(['guardian_logs', 'violationLogs'], (data) => {
  console.log('📝 访问日志:', data.guardian_logs);
  console.log('⚠️ 违规日志:', data.violationLogs);
});
```

---

## ✅ 成功标志

### 拦截页面应该显示：

```
        🛡️
   此网站已被保护
   
该网站暂时无法访问

被拦截网站：www.bilibili.com

  [返回上一页]  [申请临时访问]

💡 建议：
• 如需访问请联系管理员
• 可在管理后台查看拦截记录
• 专注学习，合理安排上网时间
```

### 插件弹窗应该显示：

```
Guardian          ● 已启用  ← 绿点

启用保护  ────────●      ← 开关在右边

今日拦截: 1             ← 有数字
```

---

## 🐛 常见错误处理

### 错误1：Uncaught TypeError

**原因**：某个元素找不到

**解决**：刷新插件

### 错误2：Cannot read property

**原因**：配置未初始化

**解决**：运行上面的一键配置脚本

### 错误3：拦截页面不显示

**检查**：
```javascript
// 查看webNavigation是否触发
chrome.webNavigation.onBeforeNavigate.hasListener
```

---

## 📞 如果还是不行

**把这些信息告诉我**：

1. Service Worker控制台的所有输出
2. 运行一键配置脚本后的输出
3. 访问B站时控制台是否有错误

**我会立即帮您解决！** 🚀


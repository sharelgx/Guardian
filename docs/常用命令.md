# Guardian 常用命令集合

**所有命令都在 Service Worker 控制台运行**

---

## 📋 基础配置

### 启用保护 + 添加黑名单

```javascript
chrome.storage.local.set({
  guardian_config: {
    enabled: true,
    mode: 'blacklist',
    blacklist: ['bilibili.com', 'www.bilibili.com', 'douyin.com'],
    whitelist: [],
    stats: { todayBlocked: 0, totalBlocked: 0, todayAllowed: 0 },
    userInfo: { userId: 'student001', username: '张三' }
  }
}, () => console.log('✅ 配置成功'));
```

### 切换到白名单模式

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.mode = 'whitelist';
  data.guardian_config.whitelist = ['baidu.com', 'wikipedia.org'];
  chrome.storage.local.set({ guardian_config: data.guardian_config }, () => {
    console.log('✅ 已切换到白名单模式');
  });
});
```

---

## 👤 用户管理

### 绑定学员信息

```javascript
chrome.runtime.sendMessage({
  action: 'bindUser',
  data: {
    userId: 'S20250101',
    username: '张三'
  }
}, (r) => console.log('绑定结果:', r));
```

### 批量绑定（集成到课堂系统时用）

```javascript
// 在课堂页面运行
const students = [
  { userId: 'S001', username: '张三' },
  { userId: 'S002', username: '李四' },
  // ...
];

students.forEach(student => {
  chrome.runtime.sendMessage(
    'pdpjidcjmkolcdaiolapcomjnbhgjekf', // 替换为实际插件ID
    {
      action: 'bindUser',
      data: student
    }
  );
});
```

---

## 🚫 黑名单管理

### 添加单个网站

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.blacklist.push('新网站.com');
  chrome.storage.local.set({ guardian_config: data.guardian_config }, () => {
    console.log('✅ 已添加');
  });
});
```

### 批量添加

```javascript
const sitesToBlock = [
  'bilibili.com',
  'douyin.com',
  'iqiyi.com',
  'v.qq.com',
  'game.com'
];

chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.blacklist = [...new Set([...data.guardian_config.blacklist, ...sitesToBlock])];
  chrome.storage.local.set({ guardian_config: data.guardian_config }, () => {
    console.log('✅ 批量添加完成:', data.guardian_config.blacklist);
  });
});
```

### 移除网站

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.blacklist = data.guardian_config.blacklist.filter(
    d => d !== 'bilibili.com'
  );
  chrome.storage.local.set({ guardian_config: data.guardian_config }, () => {
    console.log('✅ 已移除');
  });
});
```

---

## ⚠️ 违规记录

### 查看所有违规记录

```javascript
chrome.storage.local.get('violationLogs', (data) => {
  console.log('⚠️ 违规操作记录:');
  console.table(data.violationLogs);
});
```

### 导出违规记录

```javascript
chrome.storage.local.get('violationLogs', (data) => {
  const csv = '时间,用户,操作\n' + 
    data.violationLogs.map(v => 
      `${v.timestampStr},${v.username},${v.description}`
    ).join('\n');
  console.log(csv);
  // 复制输出，保存为CSV文件
});
```

### 清空违规记录

```javascript
chrome.runtime.sendMessage({
  action: 'clearViolations'
}, (r) => console.log('已清空'));
```

---

## 📊 统计查询

### 查看今日统计

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  const stats = data.guardian_config.stats;
  console.log('📊 今日统计:');
  console.log('拦截次数:', stats.todayBlocked);
  console.log('访问次数:', stats.todayAllowed);
});
```

### 查看访问日志

```javascript
chrome.storage.local.get('guardian_logs', (data) => {
  console.log('📝 访问日志:');
  console.table(data.guardian_logs);
});
```

---

## 🔐 安全设置

### 设置管理员密码

```javascript
chrome.runtime.sendMessage({
  action: 'setPassword',
  data: { password: '1234' }
}, (r) => console.log('密码已设置'));
```

### 授予临时通行证

```javascript
chrome.runtime.sendMessage({
  action: 'grantTempPass',
  data: { 
    domain: 'bilibili.com', 
    duration: 10  // 10分钟
  }
}, (r) => console.log(r.message));
```

---

## 🔄 开关控制

### 启用/禁用保护

```javascript
chrome.runtime.sendMessage({
  action: 'toggleEnabled'
}, (r) => console.log('保护状态:', r.enabled ? '已启用' : '已禁用'));
```

### 直接设置启用状态

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.enabled = true; // 或 false
  chrome.storage.local.set({ guardian_config: data.guardian_config }, () => {
    console.log('✅ 保护已启用');
  });
});
```

---

## 🧹 维护命令

### 清空所有数据（重置）

```javascript
chrome.storage.local.clear(() => {
  console.log('✅ 所有数据已清空，插件已重置');
  location.reload(); // 重新加载配置
});
```

### 查看所有存储的数据

```javascript
chrome.storage.local.get(null, (data) => {
  console.log('💾 所有存储数据:');
  console.log(data);
});
```

---

## 📱 实用技巧

### 快速测试拦截

```javascript
// 临时添加测试网站
chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.blacklist.push('test.com');
  chrome.storage.local.set({ guardian_config: data.guardian_config });
  console.log('✅ 添加成功，访问 test.com 试试');
});
```

### 查看当前状态摘要

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  const c = data.guardian_config;
  console.log(`
📊 Guardian 状态摘要
━━━━━━━━━━━━━━━━
🛡️  保护: ${c.enabled ? '✅ 已启用' : '❌ 未启用'}
📋 模式: ${c.mode === 'blacklist' ? '黑名单' : '白名单'}
🚫 黑名单: ${c.blacklist.length} 个网站
✅ 白名单: ${c.whitelist.length} 个网站
👤 用户: ${c.userInfo.username}
📈 今日拦截: ${c.stats.todayBlocked} 次
  `);
});
```

---

## 🔗 集成到MetaSeekOJ

### 课堂页面自动启用保护

在 `OnlineJudgeFE/src/pages/classroom/student/views/Learning.vue` 添加：

```javascript
mounted() {
  // 绑定学员信息
  this.bindGuardian();
  
  // 启用课堂保护模式
  this.enableClassroomProtection();
},

methods: {
  bindGuardian() {
    if (typeof chrome !== 'undefined' && chrome.runtime) {
      chrome.runtime.sendMessage(
        'pdpjidcjmkolcdaiolapcomjnbhgjekf', // Guardian插件ID
        {
          action: 'bindUser',
          data: {
            userId: this.$store.getters.user.id,
            username: this.$store.getters.user.real_name
          }
        }
      );
    }
  },
  
  enableClassroomProtection() {
    if (typeof chrome !== 'undefined' && chrome.runtime) {
      chrome.runtime.sendMessage(
        'pdpjidcjmkolcdaiolapcomjnbhgjekf',
        {
          action: 'updateConfig',
          data: {
            enabled: true,
            mode: 'whitelist',
            whitelist: ['metaseekoj.com', 'baidu.com', 'python.org']
          }
        }
      );
    }
  }
}
```

---

**保存好这些命令，以后需要时直接用！** 📝


# Guardian å¸¸ç”¨å‘½ä»¤é›†åˆ

**æ‰€æœ‰å‘½ä»¤éƒ½åœ¨ Service Worker æ§åˆ¶å°è¿è¡Œ**

---

## ğŸ“‹ åŸºç¡€é…ç½®

### å¯ç”¨ä¿æŠ¤ + æ·»åŠ é»‘åå•

```javascript
chrome.storage.local.set({
  guardian_config: {
    enabled: true,
    mode: 'blacklist',
    blacklist: ['bilibili.com', 'www.bilibili.com', 'douyin.com'],
    whitelist: [],
    stats: { todayBlocked: 0, totalBlocked: 0, todayAllowed: 0 },
    userInfo: { userId: 'student001', username: 'å¼ ä¸‰' }
  }
}, () => console.log('âœ… é…ç½®æˆåŠŸ'));
```

### åˆ‡æ¢åˆ°ç™½åå•æ¨¡å¼

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.mode = 'whitelist';
  data.guardian_config.whitelist = ['baidu.com', 'wikipedia.org'];
  chrome.storage.local.set({ guardian_config: data.guardian_config }, () => {
    console.log('âœ… å·²åˆ‡æ¢åˆ°ç™½åå•æ¨¡å¼');
  });
});
```

---

## ğŸ‘¤ ç”¨æˆ·ç®¡ç†

### ç»‘å®šå­¦å‘˜ä¿¡æ¯

```javascript
chrome.runtime.sendMessage({
  action: 'bindUser',
  data: {
    userId: 'S20250101',
    username: 'å¼ ä¸‰'
  }
}, (r) => console.log('ç»‘å®šç»“æœ:', r));
```

### æ‰¹é‡ç»‘å®šï¼ˆé›†æˆåˆ°è¯¾å ‚ç³»ç»Ÿæ—¶ç”¨ï¼‰

```javascript
// åœ¨è¯¾å ‚é¡µé¢è¿è¡Œ
const students = [
  { userId: 'S001', username: 'å¼ ä¸‰' },
  { userId: 'S002', username: 'æå››' },
  // ...
];

students.forEach(student => {
  chrome.runtime.sendMessage(
    'pdpjidcjmkolcdaiolapcomjnbhgjekf', // æ›¿æ¢ä¸ºå®é™…æ’ä»¶ID
    {
      action: 'bindUser',
      data: student
    }
  );
});
```

---

## ğŸš« é»‘åå•ç®¡ç†

### æ·»åŠ å•ä¸ªç½‘ç«™

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.blacklist.push('æ–°ç½‘ç«™.com');
  chrome.storage.local.set({ guardian_config: data.guardian_config }, () => {
    console.log('âœ… å·²æ·»åŠ ');
  });
});
```

### æ‰¹é‡æ·»åŠ 

```javascript
const sitesToBlock = [
  'bilibili.com',
  'douyin.com',
  'iqiyi.com',
  'v.qq.com',
  'game.com'
];

chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.blacklist = [...new Set([...data.guardian_config.blacklist, ...sitesToBlock])];
  chrome.storage.local.set({ guardian_config: data.guardian_config }, () => {
    console.log('âœ… æ‰¹é‡æ·»åŠ å®Œæˆ:', data.guardian_config.blacklist);
  });
});
```

### ç§»é™¤ç½‘ç«™

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.blacklist = data.guardian_config.blacklist.filter(
    d => d !== 'bilibili.com'
  );
  chrome.storage.local.set({ guardian_config: data.guardian_config }, () => {
    console.log('âœ… å·²ç§»é™¤');
  });
});
```

---

## âš ï¸ è¿è§„è®°å½•

### æŸ¥çœ‹æ‰€æœ‰è¿è§„è®°å½•

```javascript
chrome.storage.local.get('violationLogs', (data) => {
  console.log('âš ï¸ è¿è§„æ“ä½œè®°å½•:');
  console.table(data.violationLogs);
});
```

### å¯¼å‡ºè¿è§„è®°å½•

```javascript
chrome.storage.local.get('violationLogs', (data) => {
  const csv = 'æ—¶é—´,ç”¨æˆ·,æ“ä½œ\n' + 
    data.violationLogs.map(v => 
      `${v.timestampStr},${v.username},${v.description}`
    ).join('\n');
  console.log(csv);
  // å¤åˆ¶è¾“å‡ºï¼Œä¿å­˜ä¸ºCSVæ–‡ä»¶
});
```

### æ¸…ç©ºè¿è§„è®°å½•

```javascript
chrome.runtime.sendMessage({
  action: 'clearViolations'
}, (r) => console.log('å·²æ¸…ç©º'));
```

---

## ğŸ“Š ç»Ÿè®¡æŸ¥è¯¢

### æŸ¥çœ‹ä»Šæ—¥ç»Ÿè®¡

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  const stats = data.guardian_config.stats;
  console.log('ğŸ“Š ä»Šæ—¥ç»Ÿè®¡:');
  console.log('æ‹¦æˆªæ¬¡æ•°:', stats.todayBlocked);
  console.log('è®¿é—®æ¬¡æ•°:', stats.todayAllowed);
});
```

### æŸ¥çœ‹è®¿é—®æ—¥å¿—

```javascript
chrome.storage.local.get('guardian_logs', (data) => {
  console.log('ğŸ“ è®¿é—®æ—¥å¿—:');
  console.table(data.guardian_logs);
});
```

---

## ğŸ” å®‰å…¨è®¾ç½®

### è®¾ç½®ç®¡ç†å‘˜å¯†ç 

```javascript
chrome.runtime.sendMessage({
  action: 'setPassword',
  data: { password: '1234' }
}, (r) => console.log('å¯†ç å·²è®¾ç½®'));
```

### æˆäºˆä¸´æ—¶é€šè¡Œè¯

```javascript
chrome.runtime.sendMessage({
  action: 'grantTempPass',
  data: { 
    domain: 'bilibili.com', 
    duration: 10  // 10åˆ†é’Ÿ
  }
}, (r) => console.log(r.message));
```

---

## ğŸ”„ å¼€å…³æ§åˆ¶

### å¯ç”¨/ç¦ç”¨ä¿æŠ¤

```javascript
chrome.runtime.sendMessage({
  action: 'toggleEnabled'
}, (r) => console.log('ä¿æŠ¤çŠ¶æ€:', r.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'));
```

### ç›´æ¥è®¾ç½®å¯ç”¨çŠ¶æ€

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.enabled = true; // æˆ– false
  chrome.storage.local.set({ guardian_config: data.guardian_config }, () => {
    console.log('âœ… ä¿æŠ¤å·²å¯ç”¨');
  });
});
```

---

## ğŸ§¹ ç»´æŠ¤å‘½ä»¤

### æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ˆé‡ç½®ï¼‰

```javascript
chrome.storage.local.clear(() => {
  console.log('âœ… æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼Œæ’ä»¶å·²é‡ç½®');
  location.reload(); // é‡æ–°åŠ è½½é…ç½®
});
```

### æŸ¥çœ‹æ‰€æœ‰å­˜å‚¨çš„æ•°æ®

```javascript
chrome.storage.local.get(null, (data) => {
  console.log('ğŸ’¾ æ‰€æœ‰å­˜å‚¨æ•°æ®:');
  console.log(data);
});
```

---

## ğŸ“± å®ç”¨æŠ€å·§

### å¿«é€Ÿæµ‹è¯•æ‹¦æˆª

```javascript
// ä¸´æ—¶æ·»åŠ æµ‹è¯•ç½‘ç«™
chrome.storage.local.get('guardian_config', (data) => {
  data.guardian_config.blacklist.push('test.com');
  chrome.storage.local.set({ guardian_config: data.guardian_config });
  console.log('âœ… æ·»åŠ æˆåŠŸï¼Œè®¿é—® test.com è¯•è¯•');
});
```

### æŸ¥çœ‹å½“å‰çŠ¶æ€æ‘˜è¦

```javascript
chrome.storage.local.get('guardian_config', (data) => {
  const c = data.guardian_config;
  console.log(`
ğŸ“Š Guardian çŠ¶æ€æ‘˜è¦
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ›¡ï¸  ä¿æŠ¤: ${c.enabled ? 'âœ… å·²å¯ç”¨' : 'âŒ æœªå¯ç”¨'}
ğŸ“‹ æ¨¡å¼: ${c.mode === 'blacklist' ? 'é»‘åå•' : 'ç™½åå•'}
ğŸš« é»‘åå•: ${c.blacklist.length} ä¸ªç½‘ç«™
âœ… ç™½åå•: ${c.whitelist.length} ä¸ªç½‘ç«™
ğŸ‘¤ ç”¨æˆ·: ${c.userInfo.username}
ğŸ“ˆ ä»Šæ—¥æ‹¦æˆª: ${c.stats.todayBlocked} æ¬¡
  `);
});
```

---

## ğŸ”— é›†æˆåˆ°MetaSeekOJ

### è¯¾å ‚é¡µé¢è‡ªåŠ¨å¯ç”¨ä¿æŠ¤

åœ¨ `OnlineJudgeFE/src/pages/classroom/student/views/Learning.vue` æ·»åŠ ï¼š

```javascript
mounted() {
  // ç»‘å®šå­¦å‘˜ä¿¡æ¯
  this.bindGuardian();
  
  // å¯ç”¨è¯¾å ‚ä¿æŠ¤æ¨¡å¼
  this.enableClassroomProtection();
},

methods: {
  bindGuardian() {
    if (typeof chrome !== 'undefined' && chrome.runtime) {
      chrome.runtime.sendMessage(
        'pdpjidcjmkolcdaiolapcomjnbhgjekf', // Guardianæ’ä»¶ID
        {
          action: 'bindUser',
          data: {
            userId: this.$store.getters.user.id,
            username: this.$store.getters.user.real_name
          }
        }
      );
    }
  },
  
  enableClassroomProtection() {
    if (typeof chrome !== 'undefined' && chrome.runtime) {
      chrome.runtime.sendMessage(
        'pdpjidcjmkolcdaiolapcomjnbhgjekf',
        {
          action: 'updateConfig',
          data: {
            enabled: true,
            mode: 'whitelist',
            whitelist: ['metaseekoj.com', 'baidu.com', 'python.org']
          }
        }
      );
    }
  }
}
```

---

**ä¿å­˜å¥½è¿™äº›å‘½ä»¤ï¼Œä»¥åéœ€è¦æ—¶ç›´æ¥ç”¨ï¼** ğŸ“


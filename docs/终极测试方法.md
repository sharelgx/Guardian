# 🎯 Guardian 终极测试方法（100%有效）

## 问题分析

从截图看到：
- ❌ 当前网站显示 "-"（没有获取到域名）
- ❌ 保护状态"未启用"
- ❌ 所有统计都是0

**这说明插件还没有正确配置！**

---

## ✅ 终极解决方案（5步骤，必定成功）

### 第1步：完全重装插件

```
1. chrome://extensions/
2. 找到 Guardian，点击「移除」
3. 刷新页面
4. 点击「加载已解压的扩展程序」
5. 选择：
   /home/sharelgx/MetaSeekOJdev/guardian-browser-extension/extension/
6. 加载成功
```

### 第2步：打开Service Worker控制台

```
1. 还是在 chrome://extensions/
2. 找到刚安装的 Guardian
3. 点击「Service Worker」（蓝色链接）
4. 打开了控制台
```

### 第3步：运行初始化脚本

**复制这段代码到控制台：**

```javascript
// 第一步：初始化配置
const config = {
  enabled: true,
  mode: 'blacklist',
  blacklist: ['bilibili.com', 'www.bilibili.com'],
  whitelist: [],
  timeControl: { enabled: false, schedules: [] },
  dailyLimit: { 
    enabled: false, 
    maxMinutes: 120, 
    usedMinutes: 0,
    lastResetDate: new Date().toISOString().split('T')[0]
  },
  tempPass: { active: false, domain: null, expiresAt: null },
  stats: { 
    todayBlocked: 0, 
    totalBlocked: 0, 
    todayAllowed: 0,
    lastResetDate: new Date().toISOString().split('T')[0]
  },
  violationLogs: [],
  userInfo: { 
    userId: 'student001', 
    username: '张三',
    bindTime: Date.now()
  },
  password: '1234',
  firstInstall: false
};

// 保存配置
chrome.storage.local.set({ guardian_config: config }, () => {
  console.log('✅ 步骤1完成：配置已保存');
  
  // 验证配置
  chrome.storage.local.get('guardian_config', (data) => {
    console.log('✅ 步骤2完成：配置验证成功');
    console.log('当前配置:', data.guardian_config);
    console.log('保护状态:', data.guardian_config.enabled ? '已启用 ✅' : '未启用 ❌');
    console.log('黑名单:', data.guardian_config.blacklist);
    
    alert('✅ 配置成功！\n\n现在请：\n1. 打开新标签页\n2. 访问 www.bilibili.com\n3. 应该会被拦截！');
  });
});
```

**按回车执行！**

### 第4步：测试拦截

```
1. 打开新标签页（Ctrl+T）
2. 地址栏输入：www.bilibili.com
3. 按回车
```

**预期结果**：
- ✅ 页面自动跳转到拦截页面
- ✅ 显示紫色渐变背景
- ✅ 显示「此网站已被保护」

### 第5步：验证统计

```
1. 点击 Guardian 图标
2. 应该看到：
   - 状态：● 已启用（绿点）
   - 今日拦截：1
```

---

## 🔍 如果还是不行，检查这个

### 检查1：webNavigation事件是否监听

**在Service Worker控制台运行：**

```javascript
// 测试webNavigation是否工作
chrome.webNavigation.onBeforeNavigate.addListener((details) => {
  console.log('🔍 检测到导航:', details.url);
}, { url: [{ hostContains: 'bilibili' }] });

console.log('✅ 监听已添加，现在访问B站试试');
```

**然后访问B站，控制台应该显示：**
```
🔍 检测到导航: https://www.bilibili.com
```

如果没有显示，说明webNavigation权限有问题。

### 检查2：查看是否有错误

**在Service Worker控制台查看是否有红色错误：**
- 如果有，截图发给我
- 如果没有，说明代码运行正常

---

## 🎯 最简化测试（跳过所有UI）

直接测试拦截逻辑是否工作：

```javascript
// 在Service Worker控制台运行
// 手动触发拦截检查
const testUrl = 'https://www.bilibili.com';
const testDomain = 'bilibili.com';

// 假设配置
const mockState = {
  enabled: true,
  mode: 'blacklist',
  blacklist: ['bilibili.com']
};

// 检查逻辑
const shouldBlock = mockState.blacklist.includes(testDomain);

console.log('测试URL:', testUrl);
console.log('测试域名:', testDomain);
console.log('保护启用:', mockState.enabled);
console.log('在黑名单中:', shouldBlock);
console.log('结论:', shouldBlock && mockState.enabled ? '应该拦截 ✅' : '不拦截 ❌');
```

---

## 🆘 终极方案：我来重写一个超简单版本

如果上面的方法都不行，告诉我，我重新写一个**极简版本**：

- 只有拦截功能
- 没有复杂的UI
- 直接通过控制台配置
- 确保100%能用

**现在请您：**

1. **刷新插件**（chrome://extensions/ → 点刷新）
2. **运行上面第3步的代码**（初始化配置）
3. **访问B站测试**

**把Service Worker控制台的所有输出截图给我，我帮您分析！** 📸
